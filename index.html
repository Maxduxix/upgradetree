<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upgrade Tree — goofy</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: monospace;
    background: #fff;
    color: #000;
    overflow: hidden;
  }

  #tree-container {
    position: relative;
    width: 1000px;
    height: 700px;
    box-sizing: border-box;
  }

  svg#connections {
    position: absolute;
    left: 0; top: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  .node {
    position: absolute;
    width: 160px;
    height: 60px;
    border: 1px solid #000;
    border-radius: 2px;
    background: #fff;
    text-align: center;
    cursor: pointer;
    z-index: 3;
    box-sizing: border-box;
    user-select: none;
    padding: 6px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    transition: background 0.15s;
  }

  .node:hover {
    outline: 1.3px solid rgb(108, 108, 108);
  }

  .hidden-node { display: none; }

  .locked {
    background-color: gray;
    cursor: pointer;
    z-index: 4;
  }

  .bought {
    outline: 1px solid #000;
    background: #fff;
  }

  .upg-num { font-weight: bold; }
  .upg-name { font-size: 12px; color: #111; margin-top: 6px; }

  .upg-count {
    font-size: 11px;
    color: #333;
    margin-top: 2px;
  }

  .tooltip {
    position: fixed;
    display: none;
    z-index: 999;
    background: #fff;
    border: 1px solid #000;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 13px;
    width: max-content;
    max-width: 320px;
    box-shadow: 2px 2px 0 rgba(0,0,0,0.12);
    pointer-events: none;
  }

  #currency-bar {
  background-color: white;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    gap: 20px;
    height: 40px;
    border-bottom: 1px solid #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    z-index: 100;
  }

  .rate {
    font-size: 14px;
    color: #555;
  }
</style>
</head>
<body>
  <div id="currency-bar">
    Tree age: <span id="currency-value0">0</span>
    <span class="rate" id="rate0">(+0.00/s)</span>
    Leafs: <span id="currency-value1">0</span>
    <span class="rate" id="rate1">(+0.00/s)</span>
    <span id="energy-section" style="display:none">
      Energy: <span id="currency-value2">0</span>
      <span class="rate" id="rate2">(+0.00/s)</span>
    </span>
  </div>

  <div id="tree-container">
    <svg id="connections"></svg>
  </div>

  <div id="tooltip" class="tooltip"></div>

<script>
let ta = 0;
let taGain = 0.2;
let leafs = 0;
let leafGain = 0.1;
let energy = 0;
let energyGain = 0;

let t1 = 0;
let t2 = 0;
let t3 = 0;
let t4 = 0;

let x0 = 0;
let x1 = 0;
let x2 = 0;

let b1 = 1;

const currencyEl0 = document.getElementById("currency-value0");
const currencyEl1 = document.getElementById("currency-value1");
const currencyEl2 = document.getElementById("currency-value2");
const rateEl0 = document.getElementById("rate0");
const rateEl1 = document.getElementById("rate1");
const rateEl2 = document.getElementById("rate2");
const energySection = document.getElementById("energy-section");

function updateCurrency() {
  currencyEl0.textContent = ta.toFixed(2);
  currencyEl1.textContent = leafs.toFixed(2);
  currencyEl2.textContent = energy.toFixed(2);
  rateEl0.textContent = `(+${(x0 * 5).toFixed(2)}/s)`;
  rateEl1.textContent = `(+${(x1 * 5).toFixed(2)}/s)`;
  rateEl2.textContent = `(+${(x2 * 5).toFixed(2)}/s)`;
  if (t2 > 0) energySection.style.display = "inline";
}

setInterval(() => {
  energyGain = leafs / 1000;
  x0 = taGain;
  x1 = leafGain * t1 * (Math.log2(Math.pow((energy+45)/45,0.5))*t3 +1);
  x2 = energyGain * t2 *(((b1-9)/10)*t4+1);
  leafs += x1;
  energy += x2;
  ta += taGain
  updateCurrency();
}, 200);

const rows = [
[{
id: "n1",
name: "The Start of of this shit game",
cost: 0,
costCurrency: "leaf",
reward: "Start producing leaves (+0.1)",
description: "You know what this fucker does ",
px: 0,
py: 0,
effect(){ t1 =1; }
}],
[{
id: "n2a",
name: "Some steroids",
cost: 5,
costCurrency: "leaf",
reward: "+0.05 leaf gain",
description: "Absorb minerals and water more efficiently from the steroids.",
px: -0.5,
py: 0.5,
effect(){ leafGain += 0.05; }
},
{
id: "n2b",
name: "Suspicous wet tissue",
cost: 15,
costCurrency: "leaf",
reward: "+45% leaf gain",
description: "use it as a media for ur fucking plant (im so smart)",
px: 0.5,
py: 0.5,
effect(){ leafGain *= 1.45; }
}],
[{
id: "n3a",
name: "Side Effect of steroids",
cost: 15,
count: 15,
costcount: 1.35,
costCurrency: "leaf",
reward: "+22% leaf gain",
description: "smaller sausage each time..",
px: 0,
py: 1,
effect(){ leafGain += (this._baseGain ??= leafGain) * 0.22;}
}],
[{
id: "n4a",
name: "phtoto synwhtsiesiss",
cost: 30,
costCurrency: "leaf",
reward: "Start producing energy",
description: "Energy gain is based on leafs/999.99... :nerd_emoji:",
px: 0,
py: 1.5,
effect(){ t2 = 1}
},
{
id: "n4b",
name: "It gotta do something right?..",
cost: 65,
costCurrency: "leaf",
reward: "Energy now boost Leafs",
description: "energy aint useless anymore boost leaf by: (log2((((energy+45)45)^0.5))",
px: 1,
py: 1.5,
effect(){t3 =1 }
},
{
id: "n4c",
name: "Useless",
cost: 15,
costCurrency: "energy",
reward: "does absolutely nothing except +50% leaf gain and +25% energy gain",
description: "its going to be a pain to code with 2 currencies",
px: -1,
py: 1.5,
effect(){ leafGain *=1.5; energyGain *=1.25}
},
],
[{
id: "n5a",
name: "Leafs inflation",
cost: 100,
costCurrency: "leaf",
reward: "+100% leaf gain",
description: "most average upgrade",
px: 1,
py: 3,
effect(){ leafGain *= 2}
},
{
id: "n5b",
name: "leaf goggins",
cost: 250,
costCurrency: "leaf",
reward: "-35% leaf gain and +25% energy gain",
description: "'motivational speeches'",
px: -1,
py: 3,
effect(){ leafGain *0.65; energyGain *=1.25}
},
{
id: "n5c",
name: "greener leafs",
cost: 75,
costCurrency: "energy",
reward: "Boost energy by 10% every upgrade past #9",
description: "ts too op ngl",
px: 0,
py: 3,
effect(){ t4 = 1}
},
{
id: "n5d",
name: "Ultimatum",
cost: 25000,
costCurrency: "leaf",
reward: "-35% leaf gain and +25% energy gain",
description: "'motivational speeches'",
px: 0,
py: 2.5,
effect(){ leafGain *0.65; energyGain *=1.25}
},

],
[{
id: "n6a",
name: "Mechanically wetter suspicious tissue",
cost: 450,
costCurrency: "leaf",
reward: "+25% leaf gain",
description: "'flying cars they say'",
px: 0.85,
py: 3.7,
effect(){ leafGain += (this._baseGain ??= leafGain) * 0.25;}
},
{
id: "n6b",
name: "ctrl+alt+f4 those pests",
cost: 125,
costCurrency: "energy",
reward: "-35% leaf gain and +125% energy gain",
description: "THE SUN IS A DEADLY LASER",
px: -0.85,
py: 3.7,
effect(){ leafGain *0.65; energyGain *=2.25}
},
{
id: "n6c",
name: "Charged Leaf typeshit",
cost: 150,
costCurrency: "energy",
count: 15,
costcount: 1.2,
reward: "+10% leaf gain +2.5% energy gain",
description: "shockers",
px: 0,
py: 3.7,
effect(){ leafGain += (this._baseGain ??= leafGain) * 0.10; energyGain += (this._baseGain ??= energyGain) * 0.025;}
}],
[{
id: "n7a",
name: "Better wet tissue nutrients",
cost: 1450,
costCurrency: "leaf",
reward: "+215% leaf gain",
description: "goofy ahh vitamins",
px: 0,
py: 4.5,
effect(){ leafGain *=3.15;}
},
{
id: "n7b",
name: "Doomscroll",
cost: 2500,
costCurrency: "energy",
reward: "+85% leaf gain and +35% energy gain",
description: "growing....",
px: -0.95,
py: 5,
effect(){ leafGain *=1.85; energyGain *=1.35;}
},
{
id: "n7c",
name: "Tablesturned",
cost: 18500,
costCurrency: "leaf",
reward: "-85% leaf gain +125% energy gain",
description: "Real life victims",
px: 0.95,
py: 5,
effect(){ leafGain *=0.15; energyGain *= 2.25;}
}]
];

const connections = [
  { from: "n1", to: ["n2a","n2b"] },
  { from: "n2a", to: ["n3a"] },
  { from: "n3a", to: ["n4a"] },
  { from: "n4a", to: ["n4b","n4c"] },
  { from: "n4b", to: ["n5a"] },
  { from: "n4c", to: ["n5b"] },
  { from: "n5b", to: ["n5c"] },
  { from: "n5c", to: ["n6a","n6b","n6c"] },
  { from: "n6c", to: ["n7a"] },
  { from: "n7a", to: ["n7b","n7c"]},
];
const container = document.getElementById("tree-container");
const svg = document.getElementById("connections");
const tooltip = document.getElementById("tooltip");

const containerW = container.clientWidth;
const containerH = container.clientHeight;
const nodeWidth = 180;
const nodeHeight = 80;
const gapX = 260;
const gapY = 150;

const nodeMap = new Map();
const domMap = new Map();
let upgradeCounter = 1;

rows.flat().forEach(nodeCfg => {
  const x = containerW / 2 + (nodeCfg.px ?? 0) * gapX;
  const y = containerH / (rows.length + 1) + (nodeCfg.py ?? 0) * gapY;

  const node = Object.assign({}, nodeCfg, {
    x, y, visible: false, purchased: false, boughtCount: 0
  });
  node.upgNum = upgradeCounter++;
  nodeMap.set(node.id, node);

  const el = document.createElement("div");
  el.className = "node hidden-node";
  el.id = node.id;
  el.innerHTML = `<div class="upg-num">Upgrade #${node.upgNum}</div>
                  <div class="upg-name">${node.name}</div>
                  ${node.count ? `<div class="upg-count">(0/${node.count})</div>` : ""}`;
  el.style.left = `${x - nodeWidth / 2}px`;
  el.style.top = `${y - nodeHeight / 2}px`;

  el.addEventListener("mousedown", () => el.classList.add("holding"));
  el.addEventListener("mouseup", () => el.classList.remove("holding"));
  el.addEventListener("mouseleave", () => el.classList.remove("holding"));

  el.addEventListener("mouseenter", () => tooltip.style.display = "block");
  el.addEventListener("mousemove", e => {
    if (!node.visible) return;
    const r = tooltip.getBoundingClientRect();
    const m = 12;
    let left = e.clientX + m;
    let top = e.clientY + m;
    if (left + r.width > innerWidth) left = e.clientX - r.width - m;
    if (top + r.height > innerHeight) top = e.clientY - r.height - m;
    tooltip.style.left = left + "px";
    tooltip.style.top = top + "px";
  });
  el.addEventListener("mouseleave", () => tooltip.style.display = "none");

  el.addEventListener("click", () => {
    if (!node.visible) return;
    if (node.count && node.boughtCount >= node.count) return;
    if (!node.count && node.purchased) return;

    let enough = false;
    if (node.costCurrency === "energy") {
      if (energy >= node.cost) { energy -= node.cost; enough = true; }
    } else {
      if (leafs >= node.cost) { leafs -= node.cost; enough = true; }
    }
    if (!enough) return;

    updateCurrency();
    if (typeof node.effect === "function") node.effect();
    node.boughtCount++;
    b1 += 1;

    // apply cost scaling if costcount is defined
    if (node.costcount) {
      node.cost *= node.costcount;
    }

    const countEl = el.querySelector(".upg-count");
    if (countEl) countEl.textContent = `(${node.boughtCount}/${node.count})`;

    if (!node.count || node.boughtCount >= node.count) node.purchased = true;
    el.classList.remove("locked");
    if (!node.count || node.boughtCount >= node.count) el.classList.add("bought");

    const conn = connections.find(c => c.from === node.id);
    if (conn && conn.to) conn.to.forEach(childId => revealNode(childId));
    drawConnections();
  });

  container.appendChild(el);
  domMap.set(node.id, el);
});

function updateTooltip() {
  const hovered = [...domMap.values()].find(el => tooltip.style.display === "block" && el.matches(":hover"));
  if (!hovered) return;
  const node = nodeMap.get(hovered.id);
  if (!node) return;
  let icon = node.costCurrency === "energy" ? "⚡" : "🍃";
  let extra = node.count ? `<br><b>Can be bought:</b> (${node.boughtCount}/${node.count})` : "";
  let total = node.count ? `<br><b>Total Effect:</b> ${(node.boughtCount)}×` : "";
  let costInc = node.costcount ? `<br><b>Cost increase:</b> ×${node.costcount}` : "";
  tooltip.innerHTML = `<b>${node.name}</b><br><br>${node.description}<br><br>
                       <b>Cost:</b> ${node.cost.toFixed(2)} ${icon}${costInc}${extra}${total}<br><b>Reward:</b> ${node.reward}`;
}

setInterval(updateTooltip, 50);

revealNode("n1", { asLocked: false });
drawConnections();

function revealNode(id, options = { asLocked: true }) {
  const node = nodeMap.get(id);
  if (!node || node.visible) return;
  node.visible = true;
  const el = domMap.get(id);
  if (!el) return;
  el.classList.remove("hidden-node");
  if (options.asLocked === false) el.classList.remove("locked");
  else el.classList.add("locked");
}

function drawConnections() {
  while (svg.firstChild) svg.removeChild(svg.firstChild);
  const rect = container.getBoundingClientRect();
  connections.forEach(conn => {
    const parent = nodeMap.get(conn.from);
    if (!parent || (!parent.purchased && !(parent.count && parent.boughtCount > 0))) return;
    conn.to.forEach(childId => {
      const child = nodeMap.get(childId);
      if (!child || !child.visible) return;
      const pEl = domMap.get(parent.id);
      const cEl = domMap.get(child.id);
      if (!pEl || !cEl) return;
      const pRect = pEl.getBoundingClientRect();
      const cRect = cEl.getBoundingClientRect();
      const x1 = pRect.left + pRect.width / 2 - rect.left;
      const y1 = pRect.top + pRect.height / 2 - rect.top;
      const x2 = cRect.left + cRect.width / 2 - rect.left;
      const y2 = cRect.top + cRect.height / 2 - rect.top;
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", x1);
      line.setAttribute("y1", y1);
      line.setAttribute("x2", x2);
      line.setAttribute("y2", y2);
      line.setAttribute("stroke", "black");
      line.setAttribute("stroke-width", "1.3");
      svg.appendChild(line);
    });
  });
}

window.addEventListener("resize", drawConnections);
window.addEventListener("load", drawConnections);

</script>
</body>
</html>
